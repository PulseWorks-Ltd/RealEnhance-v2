{
  "$schema": "https://railway.app/railway.schema.json",
  "services": {
    "server": {
      "rootDir": "server",
      "build": {
        "builder": "NIXPACKS",
        "nixpacksPlan": {
          "providers": ["node"],
          "phases": {
            "setup": {
              "nixPkgs": ["nodejs_22", "pnpm"]
            },
            "install": {
              "cmds": [
                "pnpm install --no-frozen-lockfile --force"
              ]
            },
            "build": {
              "cmds": [
                "pnpm run build"
              ]
            }
          }
        }
      },
      "deploy": {
        "startCommand": "pnpm run start",
        "healthcheckPath": "/health",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "envVars": {
          "PORT": "8080",
          "NODE_ENV": "production"
        }
      }
    },

    "client": {
      "rootDir": "client"
      /* we can add client build/deploy later if we want to control it,
         but it's optional for now since client is already working */
    },

    "worker": {
      "rootDir": "worker"
      /* same story â€“ leave it alone unless we need custom build steps */
    }
  }
}
