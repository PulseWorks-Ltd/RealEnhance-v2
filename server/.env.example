# ==============================================
# RealEnhance Server Environment Configuration
# ==============================================

# -----------------
# Node Environment
# -----------------
NODE_ENV=development
PORT=5000

# -----------------
# CORS Configuration
# -----------------
# Comma-separated list of allowed client origins
# IMPORTANT: Must include production client URL to avoid CORS errors
PUBLIC_ORIGIN=http://localhost:5173,http://localhost:5000

# For production:
# PUBLIC_ORIGIN=https://client-production-3021.up.railway.app

# -----------------
# Client URL
# -----------------
# Used for Stripe checkout redirects and agency invite emails
# CRITICAL: Must be set to production URL in Railway for invite links to work
CLIENT_URL=http://localhost:5173

# For production:
# CLIENT_URL=https://client-production-3021.up.railway.app

# -----------------
# Session Configuration
# -----------------
# Generate a random secret: openssl rand -hex 32
SESSION_SECRET=change-this-to-a-random-secret-string-in-production

# -----------------
# Redis
# -----------------
# Required for session storage in production
REDIS_URL=redis://localhost:6379

# Railway provides REDIS_PRIVATE_URL automatically when Redis is attached
# REDIS_PRIVATE_URL is preferred over REDIS_URL for internal connections

# -----------------
# Stripe API Keys
# -----------------
# Get these from: https://dashboard.stripe.com/apikeys
# Test mode keys (for development)
STRIPE_SECRET_KEY=sk_test_your_test_key_here
STRIPE_PUBLISHABLE_KEY=pk_test_your_publishable_key_here

# Production keys (for deployment)
# STRIPE_SECRET_KEY=sk_live_your_live_key_here
# STRIPE_PUBLISHABLE_KEY=pk_live_your_publishable_key_here

# Webhook secret for verifying Stripe webhook events
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# Optional: Override Stripe API version (defaults to SDK version)
# STRIPE_API_VERSION=2024-04-10

# -----------------
# Google OAuth
# -----------------
# Get from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your_google_client_id_here.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
GOOGLE_CALLBACK_URL=http://localhost:5000/auth/google/callback

# For production:
# GOOGLE_CALLBACK_URL=https://server-production-96f7.up.railway.app/auth/google/callback

# -----------------
# Gemini AI (Auto Failure Analysis)
# -----------------
# Get your API key from: https://aistudio.google.com/apikey
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL_ANALYSIS=gemini-2.0-flash-exp
ANALYSIS_ENABLED=true
ANALYSIS_RUN_ON_FAILURE=true
ANALYSIS_MAX_IMAGES=3
ANALYSIS_TIMEOUT_MS=30000
ANALYSIS_REDACT=true

# -----------------
# SendGrid Email Service
# -----------------
# Get your API key from: https://app.sendgrid.com/settings/api_keys
# Create a "Restricted Access" key with "Mail Send" â†’ "Full Access" permission
# Free tier: 100 emails/day
SENDGRID_API_KEY=SG.your_sendgrid_api_key_here
SENDGRID_FROM_EMAIL=noreply@yourdomain.com

# -----------------
# AWS S3 (Image Storage)
# -----------------
# Required in production for image uploads
# AWS_ACCESS_KEY_ID=your_aws_access_key
# AWS_SECRET_ACCESS_KEY=your_aws_secret_key
# AWS_REGION=us-east-1
# S3_BUCKET=your-bucket-name

# -----------------
# Credits (Optional)
# -----------------
# Enable credit-based billing system
# CREDITS_ENABLED=1

# =============================================
# Worker: Structural Validation Configuration
# =============================================
# These vars configure the stage-aware structural validator.
# Set in worker environment (not server), but documented here for reference.

# -----------------
# Validator Mode
# -----------------
# Global validator mode: "off" | "log" | "retry" | "block"
# STRUCTURE_VALIDATOR_MODE=log

# Enable stage-aware validation (feature flag)
# STRUCT_VALIDATION_STAGE_AWARE=0

# -----------------
# Stage 2 Thresholds (0.0-1.0)
# -----------------
# Minimum edge IoU for Stage 2 validation
# STRUCT_VALIDATION_STAGE2_EDGE_IOU_MIN=0.60

# Minimum structural mask IoU for Stage 2
# STRUCT_VALIDATION_STAGE2_STRUCT_IOU_MIN=0.55

# Minimum line/edge score for Stage 2
# STRUCT_VALIDATION_STAGE2_LINEEDGE_MIN=0.70

# Minimum unified structural score for Stage 2
# STRUCT_VALIDATION_STAGE2_UNIFIED_MIN=0.65

# -----------------
# Hard-Fail Switches (defaults: 0 for safety)
# -----------------
# Block on window count change (add fatal trigger)
# STRUCT_VALIDATION_BLOCK_ON_WINDOW_COUNT_CHANGE=0

# Block on window position change (add fatal trigger)
# STRUCT_VALIDATION_BLOCK_ON_WINDOW_POSITION_CHANGE=0

# Block on openings delta (+1 or -1 openings)
# STRUCT_VALIDATION_BLOCK_ON_OPENINGS_DELTA=0

# -----------------
# Multi-Signal Gating
# -----------------
# Minimum number of independent triggers required to mark risk
# STRUCT_VALIDATION_GATE_MIN_SIGNALS=2

# Maximum retry attempts per stage
# STRUCT_VALIDATION_MAX_RETRY_ATTEMPTS=3

# -----------------
# Debug/Logging
# -----------------
# Save debug artifacts to disk when risk triggers
# STRUCT_VALIDATION_LOG_ARTIFACTS_ON_FAIL=1

# Directory for debug artifacts
# STRUCT_DEBUG_DIR=/tmp
